<html>
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>SSR 、v2ray 等代理模式解析 | 高亮的杂货铺</title>
<meta name="description" content="Happy coding!" />
<link rel="shortcut icon" href="https://gaoliang.me/favicon.ico?v=1568698160092">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://gaoliang.me/styles/main.css">

<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Droid+Serif:400,700">


<script async src="https://www.googletagmanager.com/gtag/js?id=UA-111489730-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-111489730-2');
</script>


  </head>
  <body>
    <div class="main">
      <div class="main-content">
        <div class="site-header">
  <a href="https://gaoliang.me">
  <img class="avatar" src="https://gaoliang.me/images/avatar.png?v=1568698160092" alt="">
  </a>
  <h1 class="site-title">
    高亮的杂货铺
  </h1>
  <p class="site-description">
    Happy coding!
  </p>
  <div class="menu-container">
    
      
        <a href="/" class="menu">
          首页
        </a>
      
    
      
        <a href="/archives" class="menu">
          归档
        </a>
      
    
      
        <a href="/tags" class="menu">
          标签
        </a>
      
    
      
        <a href="/post/about" class="menu">
          关于
        </a>
      
    
  </div>
  <div class="social-container">
    
      
        <a href="https://github.com/gaoliang" target="_blank">
          <i class="fab fa-github"></i>
        </a>
      
    
      
        <a href="https://twitter.com/im_sorghum" target="_blank">
          <i class="fab fa-twitter"></i>
        </a>
      
    
      
    
      
    
      
    
  </div>
</div>

        <div class="post-detail">
          <article class="post">
            <h2 class="post-title">
              SSR 、v2ray 等代理模式解析
            </h2>
            <div class="post-info">
              <span>
                2019-09-10
              </span>
              <span>
                1 min read
              </span>
              
                <a href="https://gaoliang.me/tag/UIik0Mktx" class="post-tag">
                  # 其他
                </a>
              
            </div>
            
              <img class="post-feature-image" src="https://gaoliang.me/post-images/ssr-v2ray-proxy-analysis.jpg" alt="">
            
            <div class="post-content-wrapper">
              <div class="post-content">
                <p>常用的代理软件，通常会有系统代理模式、PAC、代理规则等多项设置，这些设置通常都十分相近，容易混淆，所以做一次简单的梳理。<br>
ssr-csharp，shadowsocks-windows<br>
这两个 windows 软件，通常在右键菜单里会有<code>系统代理模式</code>、<code>PAC</code>、<code>代理规则</code>，三个关系到一个 url 是否会走代理的配置，为了搞清楚他们之间的关系，我们需要先知道系统代理和 PAC 是什么</p>
<ol>
<li>系统代理<br>
一个操作系统，无论是 Windows、macOS、Linux 各个发型版本，都会有对应的系统级代理设置功能，这个设置是对所有运行在操作系统上的软件公开的，所有的软件都可以知道当前是否有系统代理可用，自己是否要使用系统代理。<br>
例如，在 c# 中<pre><code class="language-c#">public static System.Net.IWebProxy GetSystemWebProxy();
</code></pre>
</li>
</ol>
<p>在我们常用的浏览器中，浏览器类的软件，通常都是默认如果你设置了系统代理，就会通过系统代理来访问外部网络，例如 Chrome、Firefox 等，都有这样的机制。 而其他的软件，通常也会设计自己的代理策略，例如走系统代理，不走系统代理，或者支持用户设置。 例如，下图中 Docker 的 macOS 客户端中，支持设置使用系统代理，但是不支持用户设置为不使用代理。<br>
<img src="https://gaoliang.me/post-images/1568105455649.png" alt="Docker上的代理设置界面"><br>
另外，在早期版本的 windows 上，经常会看到一些软件代理设置中，有<code>使用 IE 代理</code>的选项，这是因为早期版本的 Windows，IE 代理设置和系统代理设置是同步的，IE 代理就是系统代理。目前新版本的 Windows 已经不再集成 IE, 所以 大部分软件现在都该叫系统代理设置了。例如下图早期版本的迅雷代理设置截图。<br>
<img src="https://gaoliang.me/post-images/1568105326854.png" alt="早期版本的迅雷设置界面"><br>
2. PAC<br>
要说 PAC，我们就要先了解代理有哪些模式。 打开 macOS 的代理配置界面，可以看到，有多种代理协议可选，常用的包括 HTTP，SOCKS5 等。如果我们设置 HTTP 或者 SOCKS5 代理，那么启用系统代理的应用，就会将所有的请求全部转发到这个代理服务器，通过代理服务器进行访问。通常这对应着我们的 ssr 客户端里的<code>系统代理模式-&gt; 全局模式</code>,这种模式下，使用系统代理的软件，所有的网络请求就全部会通过系统代理设置的代理服务器。</p>
<p>接下来说 PAC，PAC 是 Proxy Auto-Config 的简写，系统代理可以选用这种模式。 PAC 的意思是代理自动配置，作用是是根据用户请求的地址，决定使用哪个代理服务器，PAC 通常是一个 js 脚本。 这个模式就对应 ssr <code>系统代理模式-&gt; PAC 模式</code> 在 Windows 的 ssr 客户端上，一般还支持设置不通的 PAC 规则， 例如<code>跳过局域网</code>，<code>跳过局域网和大陆IP</code>等，这些功能其实都是通过修改 PAC 的 js 脚本来实现的。<br>
<img src="https://gaoliang.me/post-images/1568106773345.png" alt="PAC 代理设置"></p>
<p>知道了系统代理和 PAC 的概念之后，我们来看下 Windows 里面 ssr 客户端的设置<br>
<code>系统代理模式-直连</code>：顾名思义，不设置任何系统代理，直接连接，不通过代理服务器。<br>
<code>系统代理模式-全局</code>：全局模式会设置系统代理的 socks5 代理，所有使用系统代理的软件的所有请求，都会通过设置的代理服务器。<br>
<code>系统代理模式-PAC</code>：设置系统代理走 PAC 模式，使用系统代理的软件发出的请求，会通过 PAC 进行自动代理切换。</p>
<p>未完待续...</p>

              </div>
              <div class="toc-container">
                
              </div>
            </div>
          </article>
        </div>

        
          <div class="next-post">
            <div class="next">下一篇</div>
            <a href="https://gaoliang.me/post/talking-about-me-and-my-favorite-toolset">
              <h3 class="post-title">
                我与我的利器
              </h3>
            </a>
          </div>
        

        
          

          
            <link rel="stylesheet" href="https://unpkg.com/disqusjs@1.1/dist/disqusjs.css">
<script src="https://unpkg.com/disqusjs@1.1/dist/disqus.js"></script>

<div id="disqus_thread"></div>

<script>

var options = {
  shortname: 'gao-liang-de-za-huo-pu',
  apikey: 'yetuLkolNo1SQ1c6oRQdEdOLdIpLHymjVOvj23cvFTFwbgwBpfjtGTHKmsSlwdfl',
}
if ('') {
  options.api = ''
}
var dsqjs = new DisqusJS(options)

</script>

          
        

        <div class="site-footer">
  Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | 
  <a class="rss" href="https://gaoliang.me/atom.xml" target="_blank">RSS</a>
</div>

<script>
  hljs.initHighlightingOnLoad()

  let mainNavLinks = document.querySelectorAll(".markdownIt-TOC a");

  // This should probably be throttled.
  // Especially because it triggers during smooth scrolling.
  // https://lodash.com/docs/4.17.10#throttle
  // You could do like...
  // window.addEventListener("scroll", () => {
  //    _.throttle(doThatStuff, 100);
  // });
  // Only not doing it here to keep this Pen dependency-free.

  window.addEventListener("scroll", event => {
    let fromTop = window.scrollY;

    mainNavLinks.forEach((link, index) => {
      let section = document.getElementById(decodeURI(link.hash).substring(1));
      let nextSection = null
      if (mainNavLinks[index + 1]) {
        nextSection = document.getElementById(decodeURI(mainNavLinks[index + 1].hash).substring(1));
      }
      console.log('section.offsetHeight', section.offsetHeight);
      if (section.offsetTop <= fromTop) {
        if (nextSection) {
          if (nextSection.offsetTop > fromTop) {
            link.classList.add("current");
          } else {
            link.classList.remove("current");    
          }
        } else {
          link.classList.add("current");
        }
      } else {
        link.classList.remove("current");
      }
    });
  });

</script>

      </div>
    </div>
  </body>
</html>
